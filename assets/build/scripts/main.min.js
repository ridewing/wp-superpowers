var Ajax=function(){var e={controller:function(e,t,a,r){a.postId=_superData.postId,$.ajax({url:_superData.api,data:{controller:e,method:t,args:a},success:function(e){"function"==typeof r&&r(e.success,e)}})}};return e},Group=function(){var e={add:function(e,t){SuperPowers.ajax.controller(_superData.controller,"addGroup",{groupId:e},function(a,r){a&&$("#"+e).find(".inside .super-group-content").last().after(r.data),t()})},remove:function(t,a){var r=$("#"+t).find(".super-group-content").eq(a);r.addClass("removed"),window.setTimeout(function(){r.remove(),e.updateGroupIndexes(t)},500)},updateGroupIndexes:function(e){var t=$("#"+e).find(".super-group-content");t.each(function(e,t){$(t).find(".controlls .number").text(e+1);var a=$(t).find(".superpower-property-value");a.each(function(t,a){var r=$(a).data("name");$(a).attr("name",r.replace("%index%",e)),$(a).attr("id",r.replace("%index%",e))})})},moveItemUp:function(t){var a=t.prev();a.length&&(t.addClass("move-up"),a.addClass("move-down"),window.setTimeout(function(){t.removeClass("move-up"),a.removeClass("move-down");var r=t.detach();a.before(r),e.updateGroupIndexes(t.data("id"))},350))},moveItemDown:function(t){var a=t.next();a.length&&(t.addClass("move-down"),a.addClass("move-up"),window.setTimeout(function(){t.removeClass("move-down"),a.removeClass("move-up");var r=t.detach();a.after(r),e.updateGroupIndexes(t.data("id"))},350))}};return $(".super-group-add").on("click",function(t){t.preventDefault();var a=Ladda.create($(this)[0]);a.start(),e.add($(this).attr("id"),function(){a.stop()})}),$(".super-group-wrapper").on("click",".super-group-content .button-remove",function(t){t.preventDefault(),e.remove($(this).data("id"),$(this).parents(".super-group-content:first").index(),function(){})}),$(".super-group-wrapper").on("click",".super-group-content .controlls .controll",function(t){t.preventDefault();var a=$(this).parents(".super-group-content:first");$(this).hasClass("controll-up")?e.moveItemUp(a):$(this).hasClass("controll-down")&&e.moveItemDown(a)}),e},SuperPowers,App=function(){var e={};return e.ajax=Ajax(),e.group=Group(),e.property={image:Image,slider:Slider},e};$(document).ready(function(){SuperPowers=App()});var Image=function(e){function t(e,t,a,r,o){var n=e/t,i=a/r,u={};if(!o&&i>n||o&&n>i){var d=t/e,s=a*d;u.size={top:-Math.round((s-r)/2),left:0,width:a,height:Math.round(s)},u.ratio=d}else{var p=e/t,l=r*p;u.size={top:0,left:-Math.round((l-a)/2),width:Math.round(l),height:r},u.ratio=p}return u}if("undefined"!=typeof e){var a=e.find(".superpower-image-size-default"),r=a.data("size").split("x"),o=({width:r[0],height:r[1]},{width:0,height:0}),n=wp.media({title:"Select Image",multiple:!1,library:{type:"image"},button:{text:"Add image"}}),i={boot:function(){o=i.scaleImage(a),e.find(".superpower-image:not(.superpower-image-size-default)").each(function(){i.scaleImage($(this))});var t=e.find(".superpower-property-attachment").val();t.length&&(t=JSON.parse(t),i.attachImage(t))},size:function(e,t){return{width:e,height:t}},getImageSizeProperty:function(e){var t=e.data("size").split("x");return i.size(t[0],t[1])},getImageSizeScaled:function(e){return e.data("scaled")},removeImage:function(){e.find(".superpower-property-value").val(""),e.removeClass("has-image")},scaleImage:function(e){var t=i.getImageSizeProperty(e),a=1,r=300,o=300;if(t.width>t.height&&t.width>r){var n=Math.min(r,t.width);a=n/t.width}else if(t.height>o){var u=Math.min(o,t.height);a=u/t.height}var n=Math.round(t.width*a),u=Math.round(t.height*a);return e.css(i.size(n,u)),e.data("scaled",i.size(n,u)),i.size(n,u)},openDialog:function(e){n.open();var t=n.uploader;t.uploader&&t.uploader.ready?t.uploader.uploader.addFile(_.toArray(e)):n.on("uploader:ready",function(){t.uploader.uploader.addFile(_.toArray(e))})},attachImage:function(t){e.addClass("has-image"),e.find(".superpower-property-value").val(JSON.stringify({id:t.id})),e.find(".superpower-image").each(function(){i.setImage($(this),t)})},setImage:function(e,a){e.find(".image-view").attr("src",a.url);var r=i.getImageSizeScaled(e),o=t(a.width,a.height,r.width,r.height);e.find(".image-view").css(o.size)}};return e.on(".image-remove-button").on("click",function(e){e.preventDefault(),i.removeImage()}),a.on("drop",function(e){e.preventDefault();var t=event.dataTransfer.files;$(this).removeClass("file-hover"),i.openDialog(t)}),a.on("click",function(e){e.preventDefault(),i.openDialog()}),n.on("select",function(){var e=n.state().get("selection").first().toJSON();i.attachImage(e)}),a.on("dragover",function(e){e.preventDefault(),$(this).addClass("file-hover")}),i.boot(),i}},Slider=function(e,t){var a={boot:function(){$(e).slider({min:0,max:10,range:"min",value:2*t,slide:function(t,a){var r=a.value/2;e.find(".superpower-property-value").val(r),e.prev().find("span").text(r.toFixed(1))}})}};a.boot()};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFqYXguanMiLCJncm91cC5qcyIsInN1cGVycHBvd2Vycy5qcyIsIlByb3BlcnR5L2ltYWdlLmpzIiwiUHJvcGVydHkvc2xpZGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLEdBQUEsTUFBQSxXQUVBLEdBQUEsSUFDQSxXQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FFQSxFQUFBLE9BQUEsV0FBQSxPQUVBLEVBQUEsTUFDQSxJQUFBLFdBQUEsSUFDQSxNQUFBLFdBQUEsRUFBQSxPQUFBLEVBQUEsS0FBQSxHQUNBLFFBQUEsU0FBQSxHQUVBLGtCQUFBLElBQ0EsRUFBQSxFQUFBLFFBQUEsT0FNQSxPQUFBLElDbkJBLE1BQUEsV0FFQSxHQUFBLElBQ0EsSUFBQSxTQUFBLEVBQUEsR0FDQSxZQUFBLEtBQUEsV0FBQSxXQUFBLFdBQUEsWUFBQSxRQUFBLEdBQUEsU0FBQSxFQUFBLEdBRUEsR0FDQSxFQUFBLElBQUEsR0FBQSxLQUFBLGdDQUFBLE9BQUEsTUFBQSxFQUFBLE1BR0EsT0FHQSxPQUFBLFNBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLElBQUEsR0FBQSxLQUFBLHdCQUFBLEdBQUEsRUFDQSxHQUFBLFNBQUEsV0FDQSxPQUFBLFdBQUEsV0FDQSxFQUFBLFNBQ0EsRUFBQSxtQkFBQSxJQUNBLE1BRUEsbUJBQUEsU0FBQSxHQUdBLEdBQUEsR0FBQSxFQUFBLElBQUEsR0FBQSxLQUFBLHVCQUVBLEdBQUEsS0FBQSxTQUFBLEVBQUEsR0FHQSxFQUFBLEdBQUEsS0FBQSxzQkFBQSxLQUFBLEVBQUEsRUFHQSxJQUFBLEdBQUEsRUFBQSxHQUFBLEtBQUEsNkJBRUEsR0FBQSxLQUFBLFNBQUEsRUFBQSxHQUdBLEdBQUEsR0FBQSxFQUFBLEdBQUEsS0FBQSxPQUdBLEdBQUEsR0FBQSxLQUFBLE9BQUEsRUFBQSxRQUFBLFVBQUEsSUFDQSxFQUFBLEdBQUEsS0FBQSxLQUFBLEVBQUEsUUFBQSxVQUFBLFNBSUEsV0FBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsTUFDQSxHQUFBLFNBQ0EsRUFBQSxTQUFBLFdBQ0EsRUFBQSxTQUFBLGFBQ0EsT0FBQSxXQUFBLFdBQ0EsRUFBQSxZQUFBLFdBQ0EsRUFBQSxZQUFBLFlBRUEsSUFBQSxHQUFBLEVBQUEsUUFDQSxHQUFBLE9BQUEsR0FDQSxFQUFBLG1CQUFBLEVBQUEsS0FBQSxRQUNBLE9BR0EsYUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsTUFDQSxHQUFBLFNBQ0EsRUFBQSxTQUFBLGFBQ0EsRUFBQSxTQUFBLFdBQ0EsT0FBQSxXQUFBLFdBQ0EsRUFBQSxZQUFBLGFBQ0EsRUFBQSxZQUFBLFVBRUEsSUFBQSxHQUFBLEVBQUEsUUFDQSxHQUFBLE1BQUEsR0FDQSxFQUFBLG1CQUFBLEVBQUEsS0FBQSxRQUNBLE9BZ0NBLE9BMUJBLEdBQUEsb0JBQUEsR0FBQSxRQUFBLFNBQUEsR0FDQSxFQUFBLGdCQUVBLElBQUEsR0FBQSxNQUFBLE9BQUEsRUFBQSxNQUFBLEdBQ0EsR0FBQSxRQUNBLEVBQUEsSUFBQSxFQUFBLE1BQUEsS0FBQSxNQUFBLFdBQ0EsRUFBQSxXQUlBLEVBQUEsd0JBQUEsR0FBQSxRQUFBLHNDQUFBLFNBQUEsR0FDQSxFQUFBLGlCQUNBLEVBQUEsT0FBQSxFQUFBLE1BQUEsS0FBQSxNQUFBLEVBQUEsTUFBQSxRQUFBLDhCQUFBLFFBQUEsZ0JBS0EsRUFBQSx3QkFBQSxHQUFBLFFBQUEsNENBQUEsU0FBQSxHQUNBLEVBQUEsZ0JBQ0EsSUFBQSxHQUFBLEVBQUEsTUFBQSxRQUFBLDZCQUNBLEdBQUEsTUFBQSxTQUFBLGVBQ0EsRUFBQSxXQUFBLEdBQ0EsRUFBQSxNQUFBLFNBQUEsa0JBQ0EsRUFBQSxhQUFBLEtBR0EsR0N4R0EsWUFFQSxJQUFBLFdBRUEsR0FBQSxLQVNBLE9BUEEsR0FBQSxLQUFBLE9BQ0EsRUFBQSxNQUFBLFFBQ0EsRUFBQSxVQUNBLE1BQUEsTUFDQSxPQUFBLFFBR0EsRUFHQSxHQUFBLFVBQUEsTUFBQSxXQUNBLFlBQUEsT0NqQkEsSUFBQSxPQUFBLFNBQUEsR0FtSkEsUUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FFQSxHQUFBLEdBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxFQUVBLElBRUEsS0FBQSxHQUFBLEVBQUEsR0FBQSxHQUFBLEVBQUEsRUFDQSxDQUNBLEdBQUEsR0FBQSxFQUFBLEVBQ0EsRUFBQSxFQUFBLENBRUEsR0FBQSxNQUVBLEtBQUEsS0FBQSxPQUFBLEVBQUEsR0FBQSxHQUNBLEtBQUEsRUFDQSxNQUFBLEVBQ0EsT0FBQSxLQUFBLE1BQUEsSUFFQSxFQUFBLE1BQUEsTUFHQSxDQUNBLEdBQUEsR0FBQSxFQUFBLEVBQ0EsRUFBQSxFQUFBLENBR0EsR0FBQSxNQUVBLElBQUEsRUFDQSxNQUFBLEtBQUEsT0FBQSxFQUFBLEdBQUEsR0FDQSxNQUFBLEtBQUEsTUFBQSxHQUNBLE9BQUEsR0FFQSxFQUFBLE1BQUEsRUFJQSxNQUFBLEdBdkxBLEdBQUEsbUJBQUEsR0FBQSxDQUVBLEdBQUEsR0FBQSxFQUFBLEtBQUEsa0NBR0EsRUFBQSxFQUFBLEtBQUEsUUFBQSxNQUFBLEtBT0EsSUFKQSxNQUFBLEVBQUEsR0FDQSxPQUFBLEVBQUEsS0FJQSxNQUFBLEVBQ0EsT0FBQSxJQUdBLEVBQUEsR0FBQSxPQUNBLE1BQUEsZUFDQSxVQUFBLEVBQ0EsU0FBQSxLQUFBLFNBQ0EsUUFBQSxLQUFBLGVBR0EsR0FDQSxLQUFBLFdBRUEsRUFBQSxFQUFBLFdBQUEsR0FFQSxFQUFBLEtBQUEseURBQUEsS0FBQSxXQUNBLEVBQUEsV0FBQSxFQUFBLFFBR0EsSUFBQSxHQUFBLEVBQUEsS0FBQSxtQ0FBQSxLQUNBLEdBQUEsU0FDQSxFQUFBLEtBQUEsTUFBQSxHQUNBLEVBQUEsWUFBQSxLQUdBLEtBQUEsU0FBQSxFQUFBLEdBQ0EsT0FBQSxNQUFBLEVBQUEsT0FBQSxJQUVBLHFCQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxLQUFBLFFBQUEsTUFBQSxJQUNBLE9BQUEsR0FBQSxLQUFBLEVBQUEsR0FBQSxFQUFBLEtBRUEsbUJBQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxLQUFBLFdBRUEsWUFBQSxXQUNBLEVBQUEsS0FBQSw4QkFBQSxJQUFBLElBQ0EsRUFBQSxZQUFBLGNBRUEsV0FBQSxTQUFBLEdBRUEsR0FBQSxHQUFBLEVBQUEscUJBQUEsR0FFQSxFQUFBLEVBQ0EsRUFBQSxJQUNBLEVBQUEsR0FFQSxJQUFBLEVBQUEsTUFBQSxFQUFBLFFBQUEsRUFBQSxNQUFBLEVBQUEsQ0FFQSxHQUFBLEdBQUEsS0FBQSxJQUFBLEVBQUEsRUFBQSxNQUNBLEdBQUEsRUFBQSxFQUFBLFVBQ0EsSUFBQSxFQUFBLE9BQUEsRUFBQSxDQUVBLEdBQUEsR0FBQSxLQUFBLElBQUEsRUFBQSxFQUFBLE9BQ0EsR0FBQSxFQUFBLEVBQUEsT0FHQSxHQUFBLEdBQUEsS0FBQSxNQUFBLEVBQUEsTUFBQSxHQUNBLEVBQUEsS0FBQSxNQUFBLEVBQUEsT0FBQSxFQU1BLE9BSkEsR0FBQSxJQUFBLEVBQUEsS0FBQSxFQUFBLElBRUEsRUFBQSxLQUFBLFNBQUEsRUFBQSxLQUFBLEVBQUEsSUFFQSxFQUFBLEtBQUEsRUFBQSxJQUVBLFdBQUEsU0FBQSxHQUNBLEVBQUEsTUFFQSxJQUFBLEdBQUEsRUFBQSxRQUNBLEdBQUEsVUFBQSxFQUFBLFNBQUEsTUFDQSxFQUFBLFNBQUEsU0FBQSxRQUFBLEVBQUEsUUFBQSxJQUVBLEVBQUEsR0FBQSxpQkFBQSxXQUNBLEVBQUEsU0FBQSxTQUFBLFFBQUEsRUFBQSxRQUFBLE9BS0EsWUFBQSxTQUFBLEdBRUEsRUFBQSxTQUFBLGFBQ0EsRUFBQSxLQUFBLDhCQUFBLElBQUEsS0FBQSxXQUFBLEdBQUEsRUFBQSxNQUVBLEVBQUEsS0FBQSxxQkFBQSxLQUFBLFdBQ0EsRUFBQSxTQUFBLEVBQUEsTUFBQSxNQUlBLFNBQUEsU0FBQSxFQUFBLEdBRUEsRUFBQSxLQUFBLGVBQUEsS0FBQSxNQUFBLEVBQUEsSUFDQSxJQUFBLEdBQUEsRUFBQSxtQkFBQSxHQUVBLEVBQUEsRUFBQSxFQUFBLE1BQUEsRUFBQSxPQUFBLEVBQUEsTUFBQSxFQUFBLE9BQ0EsR0FBQSxLQUFBLGVBQUEsSUFBQSxFQUFBLE9BNkVBLE9BekVBLEdBQUEsR0FBQSx3QkFBQSxHQUFBLFFBQUEsU0FBQSxHQUNBLEVBQUEsaUJBQ0EsRUFBQSxnQkFHQSxFQUFBLEdBQUEsT0FBQSxTQUFBLEdBQ0EsRUFBQSxnQkFFQSxJQUFBLEdBQUEsTUFBQSxhQUFBLEtBQ0EsR0FBQSxNQUFBLFlBQUEsY0FDQSxFQUFBLFdBQUEsS0FHQSxFQUFBLEdBQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxpQkFDQSxFQUFBLGVBR0EsRUFBQSxHQUFBLFNBQUEsV0FFQSxHQUFBLEdBQUEsRUFBQSxRQUFBLElBQUEsYUFBQSxRQUFBLFFBRUEsR0FBQSxZQUFBLEtBR0EsRUFBQSxHQUFBLFdBQUEsU0FBQSxHQUNBLEVBQUEsaUJBQ0EsRUFBQSxNQUFBLFNBQUEsZ0JBR0EsRUFBQSxPQTJDQSxJQzVMQSxPQUFBLFNBQUEsRUFBQSxHQUVBLEdBQUEsSUFFQSxLQUFBLFdBQ0EsRUFBQSxHQUFBLFFBQ0EsSUFBQSxFQUNBLElBQUEsR0FDQSxNQUFBLE1BQ0EsTUFBQSxFQUFBLEVBQ0EsTUFBQSxTQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxNQUFBLENBQ0EsR0FBQSxLQUFBLDhCQUFBLElBQUEsR0FDQSxFQUFBLE9BQUEsS0FBQSxRQUFBLEtBQUEsRUFBQSxRQUFBLFFBTUEsR0FBQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBBamF4ID0gZnVuY3Rpb24oKXtcblxuXHR2YXIgYWpheCA9IHtcblx0XHRjb250cm9sbGVyIDogZnVuY3Rpb24oY29udHJvbGxlciwgbWV0aG9kLCBhcmdzLCBjYWxsYmFjayl7XG5cblx0XHRcdGFyZ3MucG9zdElkID0gX3N1cGVyRGF0YS5wb3N0SWQ7XG5cblx0XHRcdCQuYWpheCh7XG5cdFx0XHRcdHVybCA6IF9zdXBlckRhdGEuYXBpLFxuXHRcdFx0XHRkYXRhOiB7Y29udHJvbGxlciA6IGNvbnRyb2xsZXIsIG1ldGhvZCA6IG1ldGhvZCwgYXJnczogYXJnc30sXG5cdFx0XHRcdHN1Y2Nlc3MgOiBmdW5jdGlvbihyZXNwKXtcblxuXHRcdFx0XHRcdGlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdGNhbGxiYWNrKHJlc3Auc3VjY2VzcywgcmVzcCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pXG5cdFx0fVxuXHR9O1xuXG5cdHJldHVybiBhamF4O1xufSIsInZhciBHcm91cCA9IGZ1bmN0aW9uKCl7XG5cblx0dmFyIGdyb3VwID0ge1xuXHRcdGFkZCA6IGZ1bmN0aW9uIChpZCwgY2FsbGJhY2spIHtcblx0XHRcdFN1cGVyUG93ZXJzLmFqYXguY29udHJvbGxlcihfc3VwZXJEYXRhLmNvbnRyb2xsZXIsICdhZGRHcm91cCcsIHsgZ3JvdXBJZCA6IGlkIH0sIGZ1bmN0aW9uIChzdWNjZXNzLCByZXNwb25zZSkge1xuXG5cdFx0XHRcdGlmIChzdWNjZXNzKSB7XG5cdFx0XHRcdFx0JCgnIycgKyBpZCkuZmluZCgnLmluc2lkZSAuc3VwZXItZ3JvdXAtY29udGVudCcpLmxhc3QoKS5hZnRlcihyZXNwb25zZS5kYXRhKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0XHR9KVxuXHRcdH0sXG5cdFx0cmVtb3ZlIDogZnVuY3Rpb24gKGdyb3VwSWQsIGluZGV4LCBjYWxsYmFjaykge1xuXHRcdFx0dmFyIGl0ZW0gPSAkKCcjJyArIGdyb3VwSWQpLmZpbmQoJy5zdXBlci1ncm91cC1jb250ZW50JykuZXEoaW5kZXgpO1xuXHRcdFx0aXRlbS5hZGRDbGFzcygncmVtb3ZlZCcpO1xuXHRcdFx0d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRpdGVtLnJlbW92ZSgpO1xuXHRcdFx0XHRncm91cC51cGRhdGVHcm91cEluZGV4ZXMoZ3JvdXBJZCk7XG5cdFx0XHR9LCA1MDApXG5cdFx0fSxcblx0XHR1cGRhdGVHcm91cEluZGV4ZXMgOiBmdW5jdGlvbiAoZ3JvdXBJZCkge1xuXG5cdFx0XHQvLyBGaW5kIGFsbCBpbnN0YW5jZXMgb2YgdGhpcyBncm91cFxuXHRcdFx0dmFyIGl0ZW1zID0gJCgnIycgKyBncm91cElkKS5maW5kKCcuc3VwZXItZ3JvdXAtY29udGVudCcpO1xuXG5cdFx0XHRpdGVtcy5lYWNoKGZ1bmN0aW9uIChrZXksIGl0ZW0pIHtcblxuXHRcdFx0XHQvLyBVcGRhdGUgY29udHJvbGwgbnVtYmVyXG5cdFx0XHRcdCQoaXRlbSkuZmluZCgnLmNvbnRyb2xscyAubnVtYmVyJykudGV4dChrZXkgKyAxKTtcblxuXHRcdFx0XHQvLyBGaW5kIGFsbCBwcm9wZXJ0eSBpbnB1dHMgaW4gdGhpcyBncm91cFxuXHRcdFx0XHR2YXIgcHJvcGVydGllcyA9ICQoaXRlbSkuZmluZCgnLnN1cGVycG93ZXItcHJvcGVydHktdmFsdWUnKTtcblxuXHRcdFx0XHRwcm9wZXJ0aWVzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwcm9wKSB7XG5cblx0XHRcdFx0XHQvLyBGZXRjaCB0aGUgbmFtZSBtb2RlbCBzbyB0aGF0IHdlIGNhbiBjcmVhdGUgYSBuZXcgbmFtZVxuXHRcdFx0XHRcdHZhciBuYW1lTW9kZWwgPSAkKHByb3ApLmRhdGEoJ25hbWUnKTtcblxuXHRcdFx0XHRcdC8vIFVwZGF0ZSBpbnB1dCBuYW1lIHNvIHRoYXQgb24gc2F2ZSB3ZSBoYXZlIHRoZSBjb3JyZWN0IGlucHV0IG5hbWVcblx0XHRcdFx0XHQkKHByb3ApLmF0dHIoJ25hbWUnLCBuYW1lTW9kZWwucmVwbGFjZSgnJWluZGV4JScsIGtleSkpO1xuXHRcdFx0XHRcdCQocHJvcCkuYXR0cignaWQnLCBuYW1lTW9kZWwucmVwbGFjZSgnJWluZGV4JScsIGtleSkpO1xuXHRcdFx0XHR9KVxuXHRcdFx0fSlcblx0XHR9LFxuXHRcdG1vdmVJdGVtVXAgOiBmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0dmFyIHByZXYgPSBpdGVtLnByZXYoKTtcblx0XHRcdGlmIChwcmV2Lmxlbmd0aCkge1xuXHRcdFx0XHRpdGVtLmFkZENsYXNzKCdtb3ZlLXVwJyk7XG5cdFx0XHRcdHByZXYuYWRkQ2xhc3MoJ21vdmUtZG93bicpO1xuXHRcdFx0XHR3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0aXRlbS5yZW1vdmVDbGFzcygnbW92ZS11cCcpO1xuXHRcdFx0XHRcdHByZXYucmVtb3ZlQ2xhc3MoJ21vdmUtZG93bicpO1xuXG5cdFx0XHRcdFx0dmFyIGhvbGQgPSBpdGVtLmRldGFjaCgpO1xuXHRcdFx0XHRcdHByZXYuYmVmb3JlKGhvbGQpO1xuXHRcdFx0XHRcdGdyb3VwLnVwZGF0ZUdyb3VwSW5kZXhlcyhpdGVtLmRhdGEoJ2lkJykpO1xuXHRcdFx0XHR9LCAzNTApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0bW92ZUl0ZW1Eb3duIDogZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdHZhciBuZXh0ID0gaXRlbS5uZXh0KCk7XG5cdFx0XHRpZiAobmV4dC5sZW5ndGgpIHtcblx0XHRcdFx0aXRlbS5hZGRDbGFzcygnbW92ZS1kb3duJyk7XG5cdFx0XHRcdG5leHQuYWRkQ2xhc3MoJ21vdmUtdXAnKTtcblx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGl0ZW0ucmVtb3ZlQ2xhc3MoJ21vdmUtZG93bicpO1xuXHRcdFx0XHRcdG5leHQucmVtb3ZlQ2xhc3MoJ21vdmUtdXAnKTtcblxuXHRcdFx0XHRcdHZhciBob2xkID0gaXRlbS5kZXRhY2goKTtcblx0XHRcdFx0XHRuZXh0LmFmdGVyKGhvbGQpO1xuXHRcdFx0XHRcdGdyb3VwLnVwZGF0ZUdyb3VwSW5kZXhlcyhpdGVtLmRhdGEoJ2lkJykpO1xuXHRcdFx0XHR9LCAzNTApXG5cdFx0XHR9XG5cdFx0fVxuXG5cdH07XG5cblx0JCgnLnN1cGVyLWdyb3VwLWFkZCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdHZhciBsb2FkZXIgPSBMYWRkYS5jcmVhdGUoJCh0aGlzKVswXSk7XG5cdFx0bG9hZGVyLnN0YXJ0KCk7XG5cdFx0Z3JvdXAuYWRkKCQodGhpcykuYXR0cignaWQnKSwgZnVuY3Rpb24oKXtcblx0XHRcdGxvYWRlci5zdG9wKCk7XG5cdFx0fSk7XG5cdH0pO1xuXG5cdCQoJy5zdXBlci1ncm91cC13cmFwcGVyJykub24oJ2NsaWNrJywgJy5zdXBlci1ncm91cC1jb250ZW50IC5idXR0b24tcmVtb3ZlJywgZnVuY3Rpb24oZSl7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdGdyb3VwLnJlbW92ZSgkKHRoaXMpLmRhdGEoJ2lkJyksICQodGhpcykucGFyZW50cygnLnN1cGVyLWdyb3VwLWNvbnRlbnQ6Zmlyc3QnKS5pbmRleCgpLCBmdW5jdGlvbigpe1xuXG5cdFx0fSlcblx0fSk7XG5cblx0JCgnLnN1cGVyLWdyb3VwLXdyYXBwZXInKS5vbignY2xpY2snLCAnLnN1cGVyLWdyb3VwLWNvbnRlbnQgLmNvbnRyb2xscyAuY29udHJvbGwnLCBmdW5jdGlvbihlKSB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdHZhciBpdGVtID0gJCh0aGlzKS5wYXJlbnRzKCcuc3VwZXItZ3JvdXAtY29udGVudDpmaXJzdCcpO1xuXHRcdGlmKCQodGhpcykuaGFzQ2xhc3MoJ2NvbnRyb2xsLXVwJykpIHtcblx0XHRcdGdyb3VwLm1vdmVJdGVtVXAoaXRlbSk7XG5cdFx0fSBlbHNlIGlmKCQodGhpcykuaGFzQ2xhc3MoJ2NvbnRyb2xsLWRvd24nKSkge1xuXHRcdFx0Z3JvdXAubW92ZUl0ZW1Eb3duKGl0ZW0pO1xuXHRcdH1cblx0fSlcblx0cmV0dXJuIGdyb3VwO1xufSIsInZhciBTdXBlclBvd2VycztcblxudmFyIEFwcCA9IGZ1bmN0aW9uKCl7XG5cblx0dmFyIHBvd2VycyA9IHt9O1xuXG5cdHBvd2Vycy5hamF4ID0gQWpheCgpO1xuXHRwb3dlcnMuZ3JvdXAgPSBHcm91cCgpO1xuXHRwb3dlcnMucHJvcGVydHkgPSB7XG5cdFx0aW1hZ2VcdDogSW1hZ2UsXG5cdFx0c2xpZGVyIFx0OiBTbGlkZXJcblx0fTtcblxuXHRyZXR1cm4gcG93ZXJzO1xufVxuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xuXHRTdXBlclBvd2VycyA9IEFwcCgpO1xufSlcbiIsInZhciBJbWFnZSA9IGZ1bmN0aW9uKGl0ZW0pe1xuXG5cdGlmKHR5cGVvZiBpdGVtID09PSAndW5kZWZpbmVkJykgcmV0dXJuO1xuXG5cdHZhciBkZWZhdWx0SW1hZ2UgPSBpdGVtLmZpbmQoJy5zdXBlcnBvd2VyLWltYWdlLXNpemUtZGVmYXVsdCcpO1xuXG5cblx0dmFyIGRhdGEgPSBkZWZhdWx0SW1hZ2UuZGF0YSgnc2l6ZScpLnNwbGl0KCd4Jyk7XG5cblx0dmFyIHNpemUgPSB7XG5cdFx0d2lkdGhcdDogZGF0YVswXSxcblx0XHRoZWlnaHQgXHQ6IGRhdGFbMV1cblx0fVxuXG5cdHZhciBuZXdTaXplID0ge1xuXHRcdHdpZHRoOiAwLFxuXHRcdGhlaWdodCA6IDBcblx0fVxuXG5cdHZhciBkaWFsb2cgPSB3cC5tZWRpYSh7XG5cdFx0dGl0bGU6IFwiU2VsZWN0IEltYWdlXCIsXG5cdFx0bXVsdGlwbGU6IGZhbHNlLFxuXHRcdGxpYnJhcnk6IHsgdHlwZTogJ2ltYWdlJyB9LFxuXHRcdGJ1dHRvbiA6IHsgdGV4dCA6ICdBZGQgaW1hZ2UnIH1cblx0fSk7XG5cblx0dmFyIHByb3BlcnR5ID0ge1xuXHRcdGJvb3QgOiBmdW5jdGlvbigpe1xuXG5cdFx0XHRuZXdTaXplID0gcHJvcGVydHkuc2NhbGVJbWFnZShkZWZhdWx0SW1hZ2UpO1xuXG5cdFx0XHRpdGVtLmZpbmQoJy5zdXBlcnBvd2VyLWltYWdlOm5vdCguc3VwZXJwb3dlci1pbWFnZS1zaXplLWRlZmF1bHQpJykuZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0XHRwcm9wZXJ0eS5zY2FsZUltYWdlKCQodGhpcykpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHZhciBhdHRhY2htZW50ID0gaXRlbS5maW5kKCcuc3VwZXJwb3dlci1wcm9wZXJ0eS1hdHRhY2htZW50JykudmFsKCk7XG5cdFx0XHRpZihhdHRhY2htZW50Lmxlbmd0aCl7XG5cdFx0XHRcdGF0dGFjaG1lbnQgPSBKU09OLnBhcnNlKGF0dGFjaG1lbnQpO1xuXHRcdFx0XHRwcm9wZXJ0eS5hdHRhY2hJbWFnZShhdHRhY2htZW50KTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdHNpemUgOiBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7XG5cdFx0XHRyZXR1cm4ge3dpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHR9O1xuXHRcdH0sXG5cdFx0Z2V0SW1hZ2VTaXplUHJvcGVydHkgOiBmdW5jdGlvbihpbWFnZSkge1xuXHRcdFx0dmFyIHNpemUgPSBpbWFnZS5kYXRhKCdzaXplJykuc3BsaXQoJ3gnKVxuXHRcdFx0cmV0dXJuIHByb3BlcnR5LnNpemUoc2l6ZVswXSwgc2l6ZVsxXSk7XG5cdFx0fSxcblx0XHRnZXRJbWFnZVNpemVTY2FsZWQgOiBmdW5jdGlvbihpbWFnZSkge1xuXHRcdFx0cmV0dXJuIGltYWdlLmRhdGEoJ3NjYWxlZCcpO1xuXHRcdH0sXG5cdFx0cmVtb3ZlSW1hZ2UgOiBmdW5jdGlvbigpIHtcblx0XHRcdGl0ZW0uZmluZCgnLnN1cGVycG93ZXItcHJvcGVydHktdmFsdWUnKS52YWwoJycpO1xuXHRcdFx0aXRlbS5yZW1vdmVDbGFzcygnaGFzLWltYWdlJyk7XG5cdFx0fSxcblx0XHRzY2FsZUltYWdlIDogZnVuY3Rpb24oaW1hZ2Upe1xuXG5cdFx0XHR2YXIgc2l6ZSA9IHByb3BlcnR5LmdldEltYWdlU2l6ZVByb3BlcnR5KGltYWdlKTtcblxuXHRcdFx0dmFyIHNjYWxlID0gMS4wO1xuXHRcdFx0dmFyIG1heFdpZHRoID0gMzAwO1xuXHRcdFx0dmFyIG1heEhlaWdodCA9IDMwMDtcblxuXHRcdFx0aWYoc2l6ZS53aWR0aCA+IHNpemUuaGVpZ2h0ICYmIHNpemUud2lkdGggPiBtYXhXaWR0aCl7XG5cblx0XHRcdFx0dmFyIHdpZHRoID0gTWF0aC5taW4obWF4V2lkdGgsIHNpemUud2lkdGgpO1xuXHRcdFx0XHRzY2FsZSA9IHdpZHRoL3NpemUud2lkdGg7XG5cdFx0XHR9IGVsc2UgaWYoc2l6ZS5oZWlnaHQgPiBtYXhIZWlnaHQpIHtcblxuXHRcdFx0XHR2YXIgaGVpZ2h0ID0gTWF0aC5taW4obWF4SGVpZ2h0LCBzaXplLmhlaWdodCk7XG5cdFx0XHRcdHNjYWxlID0gaGVpZ2h0L3NpemUuaGVpZ2h0O1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgd2lkdGggID0gTWF0aC5yb3VuZChzaXplLndpZHRoICogc2NhbGUpO1xuXHRcdFx0dmFyIGhlaWdodCA9IE1hdGgucm91bmQoc2l6ZS5oZWlnaHQgKiBzY2FsZSk7XG5cblx0XHRcdGltYWdlLmNzcyhwcm9wZXJ0eS5zaXplKHdpZHRoLCBoZWlnaHQpKTtcblxuXHRcdFx0aW1hZ2UuZGF0YSgnc2NhbGVkJywgcHJvcGVydHkuc2l6ZSh3aWR0aCwgaGVpZ2h0KSk7XG5cblx0XHRcdHJldHVybiBwcm9wZXJ0eS5zaXplKHdpZHRoLCBoZWlnaHQpO1xuXHRcdH0sXG5cdFx0b3BlbkRpYWxvZyA6IGZ1bmN0aW9uKGZpbGVzKXtcblx0XHRcdGRpYWxvZy5vcGVuKCk7XG5cblx0XHRcdHZhciB1cGxvYWRWaWV3ID0gZGlhbG9nLnVwbG9hZGVyO1xuXHRcdFx0aWYgKCB1cGxvYWRWaWV3LnVwbG9hZGVyICYmIHVwbG9hZFZpZXcudXBsb2FkZXIucmVhZHkpe1xuXHRcdFx0XHR1cGxvYWRWaWV3LnVwbG9hZGVyLnVwbG9hZGVyLmFkZEZpbGUoIF8udG9BcnJheSggZmlsZXMgKSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZGlhbG9nLm9uKCd1cGxvYWRlcjpyZWFkeScsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0dXBsb2FkVmlldy51cGxvYWRlci51cGxvYWRlci5hZGRGaWxlKCBfLnRvQXJyYXkoIGZpbGVzICkgKTtcblx0XHRcdFx0fSlcblx0XHRcdH1cblxuXHRcdH0sXG5cdFx0YXR0YWNoSW1hZ2UgOiBmdW5jdGlvbihhdHRhY2htZW50KXtcblxuXHRcdFx0aXRlbS5hZGRDbGFzcygnaGFzLWltYWdlJyk7XG5cdFx0XHRpdGVtLmZpbmQoJy5zdXBlcnBvd2VyLXByb3BlcnR5LXZhbHVlJykudmFsKEpTT04uc3RyaW5naWZ5KHsgaWQ6IGF0dGFjaG1lbnQuaWQgfSkpO1xuXG5cdFx0XHRpdGVtLmZpbmQoJy5zdXBlcnBvd2VyLWltYWdlJykuZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0XHRwcm9wZXJ0eS5zZXRJbWFnZSgkKHRoaXMpLCBhdHRhY2htZW50KTtcblx0XHRcdH0pXG5cblx0XHR9LFxuXHRcdHNldEltYWdlIDogZnVuY3Rpb24oaW1hZ2UsIGF0dGFjaG1lbnQpe1xuXG5cdFx0XHRpbWFnZS5maW5kKCcuaW1hZ2UtdmlldycpLmF0dHIoJ3NyYycsIGF0dGFjaG1lbnQudXJsKTtcblx0XHRcdHZhciBtYXggPSBwcm9wZXJ0eS5nZXRJbWFnZVNpemVTY2FsZWQoaW1hZ2UpO1xuXG5cdFx0XHR2YXIgc2l6ZSA9IGZpdEJvdW5kc0FuZFByZXNlcnZlQXNwZWN0Q1NTKGF0dGFjaG1lbnQud2lkdGgsIGF0dGFjaG1lbnQuaGVpZ2h0LCBtYXgud2lkdGgsIG1heC5oZWlnaHQpO1xuXHRcdFx0aW1hZ2UuZmluZCgnLmltYWdlLXZpZXcnKS5jc3Moc2l6ZS5zaXplKTtcblx0XHR9XG5cdH07XG5cblx0aXRlbS5vbignLmltYWdlLXJlbW92ZS1idXR0b24nKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0cHJvcGVydHkucmVtb3ZlSW1hZ2UoKTtcblx0fSlcblxuXHRkZWZhdWx0SW1hZ2Uub24oJ2Ryb3AnLCBmdW5jdGlvbihlKXtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHR2YXIgZmlsZXMgPSBldmVudC5kYXRhVHJhbnNmZXIuZmlsZXM7XG5cdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnZmlsZS1ob3ZlcicpO1xuXHRcdHByb3BlcnR5Lm9wZW5EaWFsb2coZmlsZXMpO1xuXHR9KTtcblxuXHRkZWZhdWx0SW1hZ2Uub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdHByb3BlcnR5Lm9wZW5EaWFsb2coKTtcblx0fSlcblxuXHRkaWFsb2cub24oJ3NlbGVjdCcsIGZ1bmN0aW9uKGUpXG5cdHtcblx0XHR2YXIgYXR0YWNobWVudCA9IGRpYWxvZy5zdGF0ZSgpLmdldCgnc2VsZWN0aW9uJykuZmlyc3QoKS50b0pTT04oKTtcblxuXHRcdHByb3BlcnR5LmF0dGFjaEltYWdlKGF0dGFjaG1lbnQpO1xuXHR9KTtcblxuXHRkZWZhdWx0SW1hZ2Uub24oJ2RyYWdvdmVyJyxmdW5jdGlvbihlKXtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0JCh0aGlzKS5hZGRDbGFzcygnZmlsZS1ob3ZlcicpO1xuXHR9KVxuXG5cdHByb3BlcnR5LmJvb3QoKTtcblxuXHRmdW5jdGlvbiBmaXRCb3VuZHNBbmRQcmVzZXJ2ZUFzcGVjdENTUyh3aWR0aCwgaGVpZ2h0LCB0YXJnZXRXaWR0aCwgdGFyZ2V0SGVpZ2h0LCBmaXRJbnNpZGUpXG5cdHtcblx0XHR2YXIgc291cmNlUmF0aW8gPSB3aWR0aC9oZWlnaHQ7XG5cdFx0dmFyIHRhcmdldFJhdGlvID0gdGFyZ2V0V2lkdGgvdGFyZ2V0SGVpZ2h0O1xuXG5cdFx0dmFyIHJlY3QgPSB7fTtcblxuXHRcdGlmICghZml0SW5zaWRlICYmIHRhcmdldFJhdGlvID4gc291cmNlUmF0aW8gfHwgZml0SW5zaWRlICYmIHRhcmdldFJhdGlvIDwgc291cmNlUmF0aW8pXG5cdFx0e1xuXHRcdFx0dmFyIHJhdGlvSCA9IGhlaWdodC93aWR0aDtcblx0XHRcdHZhciBuZXdIZWlnaHQgPSB0YXJnZXRXaWR0aCpyYXRpb0g7XG5cdFx0XHQvL3JlY3QgPSBbMCwgLU1hdGgucm91bmQoKG5ld0hlaWdodC10YXJnZXRIZWlnaHQpLzIpLCB0YXJnZXRXaWR0aCwgTWF0aC5yb3VuZChuZXdIZWlnaHQpXTtcblx0XHRcdHJlY3Quc2l6ZSA9XG5cdFx0XHR7XG5cdFx0XHRcdHRvcDogLU1hdGgucm91bmQoKG5ld0hlaWdodC10YXJnZXRIZWlnaHQpLzIpLFxuXHRcdFx0XHRsZWZ0OiAwLFxuXHRcdFx0XHR3aWR0aDogdGFyZ2V0V2lkdGgsXG5cdFx0XHRcdGhlaWdodDogTWF0aC5yb3VuZChuZXdIZWlnaHQpXG5cdFx0XHR9XG5cdFx0XHRyZWN0LnJhdGlvID0gcmF0aW9IO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0dmFyIHJhdGlvVyA9IHdpZHRoL2hlaWdodDtcblx0XHRcdHZhciBuZXdXaWR0aCA9IHRhcmdldEhlaWdodCpyYXRpb1c7XG5cblx0XHRcdC8vcmVjdCA9IFstTWF0aC5yb3VuZCgobmV3V2lkdGgtdGFyZ2V0V2lkdGgpLzIpLCAwLCBNYXRoLnJvdW5kKG5ld1dpZHRoKSwgdGFyZ2V0SGVpZ2h0XTtcblx0XHRcdHJlY3Quc2l6ZSA9XG5cdFx0XHR7XG5cdFx0XHRcdHRvcDogMCxcblx0XHRcdFx0bGVmdDogLU1hdGgucm91bmQoKG5ld1dpZHRoLXRhcmdldFdpZHRoKS8yKSxcblx0XHRcdFx0d2lkdGg6IE1hdGgucm91bmQobmV3V2lkdGgpLFxuXHRcdFx0XHRoZWlnaHQ6IHRhcmdldEhlaWdodFxuXHRcdFx0fVxuXHRcdFx0cmVjdC5yYXRpbyA9IHJhdGlvVztcblx0XHR9XG5cdFx0Ly9yZWN0LnB1c2godGFyZ2V0UmF0aW8sIHNvdXJjZVJhdGlvKTtcblxuXHRcdHJldHVybiByZWN0O1xuXHR9XG5cblx0cmV0dXJuIHByb3BlcnR5O1xuXG59IiwidmFyIFNsaWRlciA9IGZ1bmN0aW9uKGl0ZW0sIHZhbHVlKSB7XG5cblx0dmFyIHByb3BlcnR5ID0ge1xuXG5cdFx0Ym9vdCA6IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBzbGlkZXIgPSAkKGl0ZW0pLnNsaWRlcih7XG5cdFx0XHRcdG1pbjogMCxcblx0XHRcdFx0bWF4OiAxMCxcblx0XHRcdFx0cmFuZ2U6IFwibWluXCIsXG5cdFx0XHRcdHZhbHVlOiB2YWx1ZSoyLFxuXHRcdFx0XHRzbGlkZTogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHtcblx0XHRcdFx0XHR2YXIgdmFsdWUgPSB1aS52YWx1ZS8yO1xuXHRcdFx0XHRcdGl0ZW0uZmluZCgnLnN1cGVycG93ZXItcHJvcGVydHktdmFsdWUnKS52YWwodmFsdWUpO1xuXHRcdFx0XHRcdGl0ZW0ucHJldigpLmZpbmQoJ3NwYW4nKS50ZXh0KHZhbHVlLnRvRml4ZWQoMSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0cHJvcGVydHkuYm9vdCgpO1xuXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9